# ChainGuard AI Features Guide

## üîë API Key Management

ChainGuard stores API keys securely in `~/.chainguard/auth.toml` with 600 permissions (owner read/write only).

### Setting Up API Keys

```bash
# Set OpenAI API key (for ChatGPT)
chainguard auth set openai --key sk-proj-xxxxxxxxxxxxxx

# Set Anthropic API key (for Claude)
chainguard auth set claude --key sk-ant-api03-xxxxxxxxxxxxxx

# Set Google API key (for Gemini)
chainguard auth set gemini --key AIzaxxxxxxxxxxxxxx
```

### Managing API Keys

```bash
# List configured services
chainguard auth list

# Test connection
chainguard auth test openai
chainguard auth test claude
chainguard auth test gemini

# Test all configured services
chainguard auth test --all

# Remove an API key
chainguard auth remove openai
```

### Configuration File Location

API keys are stored in: `~/.chainguard/auth.toml`

Example structure:
```toml
[credentials.openai]
service = "openai"
api_key = "sk-proj-xxxxxxxxxxxxxx"
endpoint = "https://api.openai.com/v1"
created_at = "2024-12-19T10:30:45Z"

[credentials.claude]
service = "claude"
api_key = "sk-ant-api03-xxxxxxxxxxxxxx"
endpoint = "https://api.anthropic.com"
created_at = "2024-12-19T10:31:15Z"
```

## ü§ñ AI-Powered Analysis Features

### 1. Multi-Model Consensus Analysis

Run analysis using multiple AI models and get consensus results:

```bash
# Analyze with all configured AI models
chainguard analyze contract.go --ai-validate --consensus

# Use specific models
chainguard analyze contract.go --ai-plugins chatgpt,claude

# Set consensus threshold (default: 0.7)
chainguard analyze contract.go --consensus --consensus-level 0.8
```

### 2. AI-Generated Code Validation

Detect if code was generated by AI and check for hallucinations:

```bash
# Basic AI validation
chainguard validate contract.go

# With consensus from multiple models
chainguard validate contract.go --consensus

# Check specific patterns
chainguard validate contract.go --check-hallucinations --check-determinism
```

### 3. Interactive AI Assistant

Get real-time help and explanations:

```bash
# Start interactive mode with AI
chainguard interactive --ai-assist

# Analyze and enter interactive mode
chainguard analyze contract.go --interactive
```

### 4. AI-Powered Fix Suggestions

Get automated fix suggestions with AI explanations:

```bash
# Get fix suggestions
chainguard analyze contract.go --fix

# Apply fixes automatically (review first!)
chainguard analyze contract.go --fix --apply

# Get AI explanation for each fix
chainguard analyze contract.go --fix --explain
```

## üìä AI Analysis Output

### Consensus Report Example

```
AI Consensus Analysis Results:
==============================

Issue: Nondeterministic Time Usage
- ChatGPT: ‚úÖ Detected (95% confidence)
- Claude: ‚úÖ Detected (93% confidence)
- Gemini: ‚úÖ Detected (91% confidence)
Consensus: STRONG (3/3 models agree)

Issue: Slopsquatting Attack
- ChatGPT: ‚úÖ Detected (94% confidence)
- Claude: ‚úÖ Detected (92% confidence)
- Gemini: ‚ùå Not detected
Consensus: MODERATE (2/3 models agree)
```

### AI Validation Report Example

```
AI-Generated Code Analysis:
==========================

Overall Likelihood: 78% (High)
Consensus Level: 85%

Indicators Found:
- Self-referential AI comments
- TODO placeholders
- Inconsistent error handling
- Generic variable naming

Hallucinations Detected:
- Non-existent import path (Critical)
- Incorrect API documentation (Medium)

Quality Score: 45/100
Recommendation: Requires significant manual review
```

## üõ°Ô∏è Security Best Practices

1. **Never commit API keys** to version control
2. **Rotate keys regularly** using `chainguard auth set`
3. **Use environment variables** for CI/CD:
   ```bash
   export CHAINGUARD_OPENAI_KEY="sk-proj-xxx"
   export CHAINGUARD_CLAUDE_KEY="sk-ant-xxx"
   ```

4. **Limit API permissions** when possible
5. **Monitor API usage** to detect anomalies

## üöÄ Advanced Usage

### Custom AI Prompts

Create custom analysis prompts in `chainguard.toml`:

```toml
[ai.custom_prompts]
security_review = """
Analyze this code for security vulnerabilities specific to 
Hyperledger Fabric. Focus on consensus-breaking patterns.
"""

performance_review = """
Identify performance bottlenecks and suggest optimizations
for high-throughput blockchain applications.
"""
```

### AI Model Preferences

Configure model preferences in `chainguard.toml`:

```toml
[ai.preferences]
primary_model = "claude"  # Use Claude as primary
fallback_models = ["chatgpt", "gemini"]
consensus_threshold = 0.8
timeout_seconds = 30
retry_attempts = 3
```

### Caching AI Responses

Enable caching to reduce API calls:

```toml
[ai.cache]
enabled = true
ttl_hours = 24
max_size_mb = 100
```

## üìà Cost Management

Monitor and control AI API usage:

```bash
# Show API usage statistics
chainguard auth usage

# Set monthly limits
chainguard auth limit openai --monthly 100

# Get cost estimates before analysis
chainguard analyze contract.go --estimate-cost
```

## üÜò Troubleshooting

### Common Issues

1. **API Key Not Found**
   ```bash
   chainguard auth set openai --key YOUR_KEY
   ```

2. **Connection Failed**
   ```bash
   chainguard auth test openai --debug
   ```

3. **Rate Limiting**
   - Enable caching in config
   - Use fewer models for consensus
   - Implement retry logic

### Getting Help

```bash
# Show AI configuration
chainguard config show ai

# Validate configuration
chainguard config validate

# Reset AI configuration
chainguard config reset ai
```

## üìö Examples

### Complete Workflow

```bash
# 1. Set up API keys
chainguard auth set openai --key $OPENAI_KEY
chainguard auth set claude --key $CLAUDE_KEY

# 2. Test connections
chainguard auth test --all

# 3. Run AI-powered analysis
chainguard analyze ./contracts/ \
  --ai-validate \
  --consensus \
  --fix \
  --output-file report.json

# 4. Review and apply fixes
chainguard apply-fixes report.json --interactive
```

This guide covers all AI-powered features in ChainGuard. The AI integration enhances security analysis with multi-model consensus, hallucination detection, and intelligent fix suggestions. 